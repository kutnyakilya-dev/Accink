<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ë–∏—Ä–∂–µ–≤–æ–π –°–∏–º—É–ª—è—Ç–æ—Ä</title>
    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- –®—Ä–∏—Ñ—Ç—ã –¥–ª—è –±–æ–ª–µ–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –≤–∏–¥–∞ -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --color-bg: #111827; /* Gray-900 */
            --color-card: #1f2937; /* Gray-800 */
            --color-text: #f3f4f6; /* Gray-100 */
            --color-primary: #3b82f6; /* Blue-500 */
            --color-success: #10b981; /* Emerald-500 */
            --color-danger: #ef4444; /* Red-500 */
            --color-warning: #f59e0b; /* Amber-500 */
            --color-business: #f97316; /* Orange-500 */
            --color-transport: #8b5cf6; /* Violet-500 */
            --color-credit: #ec4899; /* Pink-500 */
            --color-apartment-sell: #854d0e; /* Brown-800 for selling apartments */
            font-family: 'Inter', sans-serif;
        }

        body {
            background-color: var(--color-bg);
            color: var(--color-text);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 20px;
        }

        .container-app {
            width: 100%;
            max-width: 1200px;
            padding-bottom: 80px; /* –£–≤–µ–ª–∏—á–∏–ª–∏ –æ—Ç—Å—Ç—É–ø –¥–ª—è –Ω–æ–≤–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ */
        }

        .card {
            background-color: var(--color-card);
            border-radius: 12px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            padding: 24px;
            transition: all 0.3s ease;
        }
        
        /* –°—Ç–∏–ª–∏ –∫–Ω–æ–ø–æ–∫ */
        .btn-action {
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 600;
            transition: background-color 0.2s, transform 0.1s;
        }

        .btn-buy { background-color: var(--color-success); color: var(--color-bg); }
        .btn-buy:hover:not(:disabled) { background-color: #059669; transform: translateY(-1px); }
        
        .btn-open-business { background-color: var(--color-business); color: var(--color-bg); }
        .btn-open-business:hover:not(:disabled) { background-color: #ea580c; transform: translateY(-1px); }
        
        .btn-sell-business { background-color: #843b0d; color: var(--color-text); }
        .btn-sell-business:hover:not(:disabled) { background-color: #9a4c16; transform: translateY(-1px); }
        
        .btn-sell-apartment { background-color: var(--color-apartment-sell); color: var(--color-text); }
        .btn-sell-apartment:hover:not(:disabled) { background-color: #a16207; transform: translateY(-1px); }
        
        .btn-sell { background-color: var(--color-danger); color: var(--color-text); }
        .btn-sell:hover:not(:disabled) { background-color: #dc2626; transform: translateY(-1px); }
        
        .btn-sell-all { background-color: #991b1b; color: var(--color-text); }
        .btn-sell-all:hover:not(:disabled) { background-color: #b91c1c; transform: translateY(-1px); }
        
        .btn-credit { background-color: var(--color-credit); color: var(--color-text); }
        .btn-credit:hover:not(:disabled) { background-color: #db2777; transform: translateY(-1px); }

        .btn-action:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è —Ü–µ–Ω */
        .price-up { animation: flash-green 0.5s ease-out; color: var(--color-success); }
        .price-down { animation: flash-red 0.5s ease-out; color: var(--color-danger); }
        @keyframes flash-green { 0% { background-color: rgba(16, 185, 129, 0.3); } 100% { background-color: transparent; } }
        @keyframes flash-red { 0% { background-color: rgba(239, 68, 68, 0.3); } 100% { background-color: transparent; } }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
        #message-box {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
            max-width: 90%; z-index: 100;
        }
        
        /* –û–∫–Ω–æ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π –ø—Ä–æ–¥–∞–∂–∏ */
        #force-sell-overlay {
            z-index: 999;
        }

        /* –°–∫—Ä–æ–ª–ª –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ */
        #nav-scroll-container {
            overflow-x: auto;
            white-space: nowrap;
            scrollbar-width: none; /* Firefox */
        }
        #nav-scroll-container::-webkit-scrollbar { display: none; /* Chrome, Safari */ }

        /* –°–∫—Ä–æ–ª–ª –¥–ª—è –æ–∫–Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π */
        .update-content-scroll::-webkit-scrollbar { width: 8px; }
        .update-content-scroll::-webkit-scrollbar-track { background: var(--color-bg); border-radius: 10px; }
        .update-content-scroll::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 10px; }
        .update-content-scroll::-webkit-scrollbar-thumb:hover { background: #6b7280; }
        .update-content-scroll { scrollbar-color: #4b5563 var(--color-bg); scrollbar-width: thin; }


        @media (min-width: 1024px) { #nav-bar { display: none !important; } }
        .nav-item-active { color: var(--color-primary); }
    </style>
</head>
<body class="p-4 md:p-8">

<!-- –û–∫–Ω–æ –û–±–Ω–æ–≤–ª–µ–Ω–∏–π -->
<div id="update-overlay" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center p-4 z-[1000]">
    <div class="card max-w-lg w-full border-2 border-blue-500 flex flex-col max-h-[90vh]">
        <h2 class="text-2xl font-bold text-blue-400 mb-4 flex-shrink-0">–ß—Ç–æ –Ω–æ–≤–æ–≥–æ –≤ –≤–µ—Ä—Å–∏–∏ 1.4.0 "ULTRA UPDATE"</h2>
        <div class="update-content-scroll flex-grow overflow-y-auto pr-2">
            <div class="text-gray-300 space-y-3 mb-6 text-left">
                <p>‚úÖ <span class="font-semibold">–£—Å–∫–æ—Ä–µ–Ω –¥–æ—Ö–æ–¥:</span> –ë–∏–∑–Ω–µ—Å —Ç–µ–ø–µ—Ä—å –ø—Ä–∏–Ω–æ—Å–∏—Ç –ø—Ä–∏–±—ã–ª—å –∫–∞–∂–¥—ã–µ 6 —Å–µ–∫, –∞ –∫–≤–∞—Ä—Ç–∏—Ä—ã - –∫–∞–∂–¥—ã–µ 8 —Å–µ–∫!</p>
                <p>üè† <span class="font-semibold">–ù–æ–≤–∞—è –ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å:</span> –î–æ–±–∞–≤–ª–µ–Ω—ã —ç–ª–∏—Ç–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã, –≤–∫–ª—é—á–∞—è –≤–∏–ª–ª—ã –∏ –ø–æ–º–µ—Å—Ç—å—è —Å—Ç–æ–∏–º–æ—Å—Ç—å—é –¥–æ 10,000,000 –≥—Ä–Ω.</p>
                <p>üöó <span class="font-semibold">–ù–æ–≤—ã–π —Ä–∞–∑–¥–µ–ª "–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç":</span> –ü–æ–∫—É–ø–∞–π—Ç–µ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç (–æ—Ç —Å–∫—É—Ç–µ—Ä–æ–≤ –¥–æ —Å–∞–º–æ–ª–µ—Ç–æ–≤) –∏ –ø–æ–ª—É—á–∞–π—Ç–µ 3% –¥–æ—Ö–æ–¥–∞ –æ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∫–∞–∂–¥—ã–µ 4 —Å–µ–∫—É–Ω–¥—ã.</p>
                <p>üí∞ <span class="font-semibold">–°–∏—Å—Ç–µ–º–∞ –ö—Ä–µ–¥–∏—Ç–æ–≤:</span> –ù—É–∂–Ω—ã –¥–µ–Ω—å–≥–∏? –í–æ–∑—å–º–∏—Ç–µ –∫—Ä–µ–¥–∏—Ç! –ù–æ –Ω–µ –∑–∞–±—ã–≤–∞–π—Ç–µ –ø–æ–≥–∞—Å–∏—Ç—å –µ–≥–æ –≤–æ–≤—Ä–µ–º—è, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å —à—Ç—Ä–∞—Ñ–æ–≤.</p>
                <p>‚ÜîÔ∏è <span class="font-semibold">–£–ª—É—á—à–µ–Ω–Ω–∞—è –ù–∞–≤–∏–≥–∞—Ü–∏—è:</span> –ù–∏–∂–Ω—è—è –ø–∞–Ω–µ–ª—å —Ç–µ–ø–µ—Ä—å –ø—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ—Ç—Å—è –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫–æ –≤—Å–µ–º —Ä–∞–∑–¥–µ–ª–∞–º.</p>
                <p>üóëÔ∏è <span class="font-semibold">–£–¥–∞–ª–µ–Ω–∏–µ –ü—Ä–æ–º–æ–∫–æ–¥–æ–≤:</span> –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤ –±—ã–ª–∞ —É–±—Ä–∞–Ω–∞ –∏–∑ –∏–≥—Ä—ã.</p>
            </div>
        </div>
        <button id="close-update-btn" class="btn-action bg-blue-600 hover:bg-blue-700 text-white w-full mt-4 flex-shrink-0">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
    </div>
</div>

<!-- –û–≤–µ—Ä–ª–µ–π –∑–∞–≥—Ä—É–∑–∫–∏ -->
<div id="loading-overlay" class="fixed inset-0 bg-gray-900 bg-opacity-90 flex items-center justify-center z-50">
    <div class="text-xl font-semibold flex items-center space-x-2">
        <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-blue-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
        –ó–∞–≥—Ä—É–∑–∫–∞ —Ä—ã–Ω–∫–∞...
    </div>
</div>

<!-- –û–≤–µ—Ä–ª–µ–π –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π –ø—Ä–æ–¥–∞–∂–∏ -->
<div id="force-sell-overlay" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center p-4">
    <div class="card max-w-lg w-full text-center border-4 border-red-500">
        <h2 class="text-3xl font-bold text-red-400 mb-4">–¢—Ä–µ–±—É–µ—Ç—Å—è –ü–æ–≥–∞—à–µ–Ω–∏–µ –ö—Ä–µ–¥–∏—Ç–∞!</h2>
        <p class="text-gray-300 mb-2">–ù–∞ –≤–∞—à–µ–º –±–∞–ª–∞–Ω—Å–µ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–ø–∏—Å–∞–Ω–∏—è –¥–æ–ª–≥–∞.</p>
        <p id="force-sell-debt-info" class="text-lg font-semibold text-white mb-6">–û—Å—Ç–∞—Ç–æ–∫ –¥–æ–ª–≥–∞: 0.00 –≥—Ä–Ω</p>
        <p class="text-gray-400">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–¥–∞–π—Ç–µ –∞–∫—Ç–∏–≤—ã (–∞–∫—Ü–∏–∏, —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç, –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å, –±–∏–∑–Ω–µ—Å), —á—Ç–æ–±—ã –ø–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å –∏ –∏–∑–±–µ–∂–∞—Ç—å –¥–∞–ª—å–Ω–µ–π—à–∏—Ö —à—Ç—Ä–∞—Ñ–æ–≤.</p>
    </div>
</div>


<div class="container-app hidden" id="app-container">
    <header class="mb-6 pb-4 border-b border-gray-700">
        <h1 class="text-3xl font-bold text-white mb-2">–ë–∏—Ä–∂–µ–≤–æ–π –°–∏–º—É–ª—è—Ç–æ—Ä</h1>
        <p class="text-gray-400">–¢–æ—Ä–≥—É–π—Ç–µ, —Å–ª–µ–¥–∏—Ç–µ –∑–∞ —Ü–µ–Ω–∞–º–∏ –∏ —É–ø—Ä–∞–≤–ª—è–π—Ç–µ —Å–≤–æ–∏–º –ø–æ—Ä—Ç—Ñ–µ–ª–µ–º.</p>
    </header>

    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <div class="card md:col-span-2">
            <h2 class="text-xl font-semibold mb-3 text-blue-400">–ú–æ–π –ü–æ—Ä—Ç—Ñ–µ–ª—å</h2>
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center">
                <div class="mb-3 sm:mb-0">
                    <p class="text-gray-400 text-sm">–ë–∞–ª–∞–Ω—Å (UAH)</p>
                    <p id="player-balance" class="text-3xl font-bold text-white">0.00</p>
                    <p id="passive-income-info" class="text-sm font-medium text-green-500 mt-1">–î–æ—Ö–æ–¥ (–ö–≤–∞—Ä—Ç–∏—Ä—ã): 0.00 –≥—Ä–Ω / 8 —Å–µ–∫</p>
                    <p id="business-income-info" class="text-sm font-medium text-orange-500 mt-1">–î–æ—Ö–æ–¥ (–ë–∏–∑–Ω–µ—Å): 0.00 –≥—Ä–Ω / 6 —Å–µ–∫</p>
                    <p id="transport-income-info" class="text-sm font-medium text-violet-500 mt-1">–î–æ—Ö–æ–¥ (–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç): 0.00 –≥—Ä–Ω / 4 —Å–µ–∫</p>
                </div>
                <div>
                    <p class="text-gray-400 text-sm">–í–∞—à ID:</p>
                    <p id="user-id" class="text-sm font-mono text-gray-400 truncate"></p>
                </div>
            </div>
        </div>
        <div class="card flex flex-col justify-center">
             <h2 class="text-xl font-semibold mb-2 text-blue-400">–û–±—â–µ–µ –°–æ—Å—Ç–æ—è–Ω–∏–µ</h2>
             <div class="grid grid-cols-2 gap-x-4">
                 <div>
                    <p class="text-gray-400 text-sm">–¶–µ–Ω—ã/–õ–∏–º–∏—Ç—ã:</p><p id="limit-countdown" class="text-lg font-bold text-yellow-400">00:00</p>
                    <p class="text-gray-400 text-sm mt-2">–î–æ—Ö–æ–¥ (–ö–≤.):</p><p id="income-countdown" class="text-lg font-bold text-green-400">00</p>
                 </div>
                 <div>
                    <p class="text-gray-400 text-sm">–î–æ—Ö–æ–¥ (–ë–∏–∑.):</p><p id="business-countdown" class="text-lg font-bold text-orange-400">00</p>
                    <p class="text-gray-400 text-sm mt-2">–î–æ—Ö–æ–¥ (–¢—Ä.):</p><p id="transport-countdown" class="text-lg font-bold text-violet-400">00</p>
                 </div>
             </div>
             <p class="text-gray-400 text-sm mt-2 border-t border-gray-700 pt-2">–ü–æ–≥–∞—à–µ–Ω–∏–µ –∫—Ä–µ–¥–∏—Ç–∞ —á–µ—Ä–µ–∑:</p>
             <p id="loan-timer-display" class="text-lg font-bold text-pink-400">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫—Ä–µ–¥–∏—Ç–æ–≤</p>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <div id="main-content-sections">
        
        <!-- –°–µ–∫—Ü–∏—è –†—ã–Ω–∫–∞ -->
        <div id="market-section" class="main-content-section"><div class="card"><h2 class="text-2xl font-semibold mb-4">–ë–∏—Ä–∂–∞ (–ê–∫—Ü–∏–∏)</h2><div id="market-list" class="space-y-4"></div></div></div>

        <!-- –°–µ–∫—Ü–∏—è –ö–≤–∞—Ä—Ç–∏—Ä -->
        <div id="real-estate-section" class="main-content-section hidden"><div class="card"><h2 class="text-2xl font-semibold mb-4">–ö–≤–∞—Ä—Ç–∏—Ä—ã (–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å)</h2><p class="text-gray-400 text-sm mb-4">–ú–∞–≥–∞–∑–∏–Ω –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 3 –º–∏–Ω—É—Ç—ã. <span id="apartment-countdown" class="font-bold text-yellow-400 ml-2">00:00</span></p><div id="apartment-list" class="space-y-4"></div></div></div>
        
        <!-- –°–µ–∫—Ü–∏—è –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ -->
        <div id="transport-section" class="main-content-section hidden"><div class="card"><h2 class="text-2xl font-semibold mb-4">–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</h2><p class="text-gray-400 text-sm mb-4">–ú–∞–≥–∞–∑–∏–Ω –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 3 –º–∏–Ω—É—Ç—ã. –î–æ—Ö–æ–¥: 3% –æ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∫–∞–∂–¥—ã–µ 4 —Å–µ–∫—É–Ω–¥—ã.<span id="transport-store-countdown" class="font-bold text-yellow-400 ml-2">00:00</span></p><div id="transport-list" class="space-y-4"></div></div></div>

        <!-- –°–µ–∫—Ü–∏—è –ë–∏–∑–Ω–µ—Å–∞ -->
        <div id="business-section" class="main-content-section hidden"><div class="card"><h2 class="text-2xl font-semibold mb-4">–ë–∏–∑–Ω–µ—Å</h2><p class="text-gray-400 mb-4">–ü—Ä–∏–±—ã–ª—å: <span class="font-bold text-orange-400">0.90% –æ—Ç –≤–ª–æ–∂–µ–Ω–∏–π</span> –∫–∞–∂–¥—ã–µ <span class="font-bold text-orange-400">6 —Å–µ–∫—É–Ω–¥</span>. –õ–∏–º–∏—Ç: <span id="business-count" class="font-bold text-white ml-2">0/20</span></p><div class="card bg-gray-900 mb-6"><h3 class="text-xl font-semibold mb-3">–û—Ç–∫—Ä—ã—Ç—å –Ω–æ–≤—ã–π –±–∏–∑–Ω–µ—Å</h3><div class="space-y-4"><input type="text" id="business-name-input" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –±–∏–∑–Ω–µ—Å–∞" class="w-full p-3 rounded-lg bg-gray-700 border border-gray-600 focus:ring-orange-500 focus:border-orange-500" /><input type="number" id="business-investment-input" placeholder="–°—É–º–º–∞ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π (–æ—Ç 1 –≥—Ä–Ω)" class="w-full p-3 rounded-lg bg-gray-700 border border-gray-600 focus:ring-orange-500 focus:border-orange-500" /><button id="open-business-btn" onclick="handleOpenBusiness()" class="btn-action btn-open-business w-full">–û—Ç–∫—Ä—ã—Ç—å –ë–∏–∑–Ω–µ—Å</button></div></div><h3 class="text-xl font-semibold mb-3">–ú–æ–∏ –ë–∏–∑–Ω–µ—Å—ã</h3><div id="business-list" class="space-y-4"></div></div></div>
        
        <!-- –°–µ–∫—Ü–∏—è –ö—Ä–µ–¥–∏—Ç–æ–≤ -->
        <div id="credits-section" class="main-content-section hidden"><div class="card"><h2 class="text-2xl font-semibold mb-4 text-pink-400">–ö—Ä–µ–¥–∏—Ç–æ–≤–∞–Ω–∏–µ</h2><div id="credit-status-section"></div><div id="take-credit-section" class="hidden mt-6 card bg-gray-900"><h3 class="text-xl font-semibold mb-3">–í–∑—è—Ç—å –ö—Ä–µ–¥–∏—Ç</h3><p class="text-gray-400 text-sm mb-4">–ö–æ–º–∏—Å—Å–∏—è –∑–∞ –ø–æ–≥–∞—à–µ–Ω–∏–µ: <span class="font-bold text-white">20%</span>. –°—Ä–æ–∫ –¥–æ –∞–≤—Ç–æ-—Å–ø–∏—Å–∞–Ω–∏—è: <span class="font-bold text-white">5 –º–∏–Ω—É—Ç</span>.</p><div class="space-y-4"><p class="text-gray-300">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –¥–æ—Å—Ç—É–ø–Ω–æ: <span id="max-loan-amount" class="font-bold text-lg text-white">0.00 –≥—Ä–Ω</span></p><input type="number" id="loan-amount-input" placeholder="–°—É–º–º–∞ –∫—Ä–µ–¥–∏—Ç–∞" class="w-full p-3 rounded-lg bg-gray-700 border border-gray-600 focus:ring-pink-500 focus:border-pink-500" /><button onclick="handleTakeLoan()" class="btn-action btn-credit w-full">–í–∑—è—Ç—å –ö—Ä–µ–¥–∏—Ç</button></div></div></div></div>

        <!-- –°–µ–∫—Ü–∏—è –ò–Ω–≤–µ–Ω—Ç–∞—Ä—è -->
        <div id="inventory-section" class="main-content-section hidden"><div class="card"><h2 class="text-2xl font-semibold mb-4">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</h2><div id="inventory-list" class="space-y-4"></div></div></div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏—è -->
<div id="message-box" class="fixed bg-gray-700 text-white p-4 rounded-lg shadow-xl hidden z-50"></div>

<!-- –ù–∏–∂–Ω—è—è –Ω–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω–∞—è –ø–∞–Ω–µ–ª—å -->
<footer id="nav-bar" class="fixed bottom-0 left-0 right-0 bg-gray-800 border-t border-gray-700 p-2 z-40">
    <div id="nav-scroll-container">
        <div class="flex items-center space-x-2 px-2">
            <!-- –ö–Ω–æ–ø–∫–∞ –ë–∏—Ä–∂–∞ -->
            <button id="nav-market" onclick="showSection('market')" class="flex-shrink-0 nav-item-active text-blue-400 p-2 rounded-lg hover:text-white transition-colors flex flex-col items-center text-xs w-20"><svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path></svg>–ë–∏—Ä–∂–∞</button>
            <!-- –ö–Ω–æ–ø–∫–∞ –ö–≤–∞—Ä—Ç–∏—Ä—ã -->
            <button id="nav-real-estate" onclick="showSection('real-estate')" class="flex-shrink-0 text-gray-400 p-2 rounded-lg hover:text-white transition-colors flex flex-col items-center text-xs w-20"><svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5a2 2 0 00-2 2v6a2 2 0 002 2h14a2 2 0 002-2v-6a2 2 0 00-2-2zM5 11V9a2 2 0 012-2h10a2 2 0 012 2v2"></path></svg>–ö–≤–∞—Ä—Ç–∏—Ä—ã</button>
            <!-- –ö–Ω–æ–ø–∫–∞ –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç -->
            <button id="nav-transport" onclick="showSection('transport')" class="flex-shrink-0 text-gray-400 p-2 rounded-lg hover:text-white transition-colors flex flex-col items-center text-xs w-20"><svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 16v-2m4-14h2m-16 0h2m14 4v2m-16 0v2m4 4h2m-2 4h2m-4-4h.01M12 8h.01M8 12h.01M16 12h.01"></path></svg>–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</button>
            <!-- –ö–Ω–æ–ø–∫–∞ –ë–∏–∑–Ω–µ—Å -->
            <button id="nav-business" onclick="showSection('business')" class="flex-shrink-0 text-gray-400 p-2 rounded-lg hover:text-white transition-colors flex flex-col items-center text-xs w-20"><svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.565 23.565 0 0112 15c-3.185 0-6.223-.56-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M12 20h.01M12 17h.01M12 14h.01M12 11h.01M12 8h.01M12 5h.01M19 11H5a2 2 0 00-2 2v6a2 2 0 002 2h14a2 2 0 002-2v-6a2 2 0 00-2-2z"></path></svg>–ë–∏–∑–Ω–µ—Å</button>
            <!-- –ö–Ω–æ–ø–∫–∞ –ö—Ä–µ–¥–∏—Ç—ã -->
            <button id="nav-credits" onclick="showSection('credits')" class="flex-shrink-0 text-gray-400 p-2 rounded-lg hover:text-white transition-colors flex flex-col items-center text-xs w-20"><svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v.01M12 6v-1h4a1 1 0 011 1v12a1 1 0 01-1 1h-4v-1m-4 0v1H8a1 1 0 01-1-1V7a1 1 0 011-1h4V6m-4 0V5a1 1 0 011-1h4a1 1 0 011 1v1M5 12h14"></path></svg>–ö—Ä–µ–¥–∏—Ç—ã</button>
            <!-- –ö–Ω–æ–ø–∫–∞ –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å -->
            <button id="nav-inventory" onclick="showSection('inventory')" class="flex-shrink-0 text-gray-400 p-2 rounded-lg hover:text-white transition-colors flex flex-col items-center text-xs w-20"><svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M3 14h18m-9-4v8m-9 0h18a2 2 0 002-2V8a2 2 0 00-2-2H3a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</button>
        </div>
    </div>
</footer>


<script type="module">
    // --- –í–ï–†–°–ò–Ø –ò–ì–†–´ ---
    const CURRENT_VERSION = '1.4.0';
    const LOCAL_STORAGE_KEY_UPDATE_SEEN = `stockSimUpdateSeen_${CURRENT_VERSION}`;

    // --- –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ---
    let userId = null;
    let portfolio = { 
        balance: 0, 
        inventory: {}, 
        realEstate: {}, 
        businesses: [],
        transport: {},
        activeLoan: null
    };
    let currentPrices = {}; 
    let isMarketEngineRunning = false;
    let marketLimits = {}; 
    let lastPrevPrices = {}; 
    let limitTimerRemaining = 0; 
    let apartmentTimerRemaining = 0; 
    let transportStoreTimerRemaining = 0;
    
    // --- –ö–û–ù–°–¢–ê–ù–¢–´ –ò–ù–¢–ï–†–í–ê–õ–û–í (–º—Å) ---
    const STOCK_LIMIT_REFRESH_INTERVAL = 60000;
    const REAL_ESTATE_REFRESH_INTERVAL = 180000;
    const TRANSPORT_REFRESH_INTERVAL = 180000;
    const PRICE_UPDATE_INTERVAL_MIN = 5000;
    const PRICE_UPDATE_INTERVAL_MAX = 10000;
    
    // –ö–û–ù–°–¢–ê–ù–¢–´ –î–û–•–û–î–ê
    const PASSIVE_INCOME_INTERVAL = 8000;
    const APARTMENT_FIXED_INCOME_RATE = 0.015;
    const APARTMENT_SALE_FACTOR = 0.60;
    const BUSINESS_INCOME_INTERVAL = 6000;
    const BUSINESS_INCOME_RATE = 0.0090;
    const TRANSPORT_INCOME_INTERVAL = 4000;
    const TRANSPORT_INCOME_RATE = 0.03;
    const TRANSPORT_SALE_FACTOR = 0.70;

    // –ö–û–ù–°–¢–ê–ù–¢–´ –ö–†–ï–î–ò–¢–ê
    const LOAN_REPAYMENT_FEE = 1.20;
    const LOAN_GRACE_PERIOD = 300000;
    const LOAN_AUTO_DEDUCT_INTERVAL = 120000;
    const LOAN_AUTO_DEDUCT_PERCENT = 0.10;

    const MAX_SIM_PRICE = 50000000.00;
    const MAX_BUSINESSES = 20;
    const initialBalance = 500.00;

    // --- –î–ê–ù–ù–´–ï –ê–ö–¢–ò–í–û–í ---
    const initialPrices = { 'NOVA': 37000000, 'AETHER': 27000000, 'ZETA': 14000000, 'ULTRA': 8000000, 'COSMO': 5800000, 'GIANT': 4300000, 'STAR': 3300000, 'TITAN': 4500000, 'QUANT': 3500000, 'SPACE': 1250000, 'ROBOT': 750000, 'CYBER': 580000, 'LUX_H': 240000, 'MINES': 150000, 'BANK': 98000, 'HEALTH': 55000, 'BIO': 27000, 'MEDIA': 22000, 'GREEN': 11000, 'NEW_T': 9200, 'GALAXY': 6850, 'GOLDX': 4520, 'PHARMA': 3100, 'AERO': 1850, 'ECOT': 980, 'DREAM': 640, 'STEEL': 350, 'FOOD': 210, 'MERC': 150, 'CRYP': 95, 'OIL': 75, 'SOFT': 48, 'MINI': 27, 'WATER': 18, 'CANDY': 14.50, };
    const assetNames = { 'NOVA': '–ù–æ–≤–∞ –≠–Ω–µ—Ä–¥–∂–∏', 'AETHER': '–≠—Ñ–∏—Ä –ì–ª–æ–±–∞–ª', 'ZETA': '–ó–µ—Ç–∞ –•–æ–ª–¥–∏–Ω–≥', 'ULTRA': '–£–ª—å—Ç—Ä–∞ –ö–æ—Ä–ø.', 'COSMO': '–ö–æ—Å–º–æ –ò–Ω–¥–∞—Å—Ç—Ä–∏–∑', 'GIANT': '–ì–∏–≥–∞–Ω—Ç –°—Ç—Ä–æ–π', 'STAR': '–°—Ç–∞—Ä–õ–∞–π—Ç –ì—Ä—É–ø–ø', 'TITAN': '–¢–∏—Ç–∞–Ω –ò–Ω–¥–∞—Å—Ç—Ä–∏–∑', 'QUANT': '–ö–≤–∞–Ω—Ç–æ–≤—ã–µ –°–∏—Å—Ç–µ–º—ã', 'SPACE': '–°–ø–µ–π—Å –ò–∫—Å–ø–ª–æ—Ä–µ—Ä', 'ROBOT': '–†–æ–±–æ–¢–µ—Ö–Ω–∏–∫—Å', 'CYBER': '–ö–∏–±–µ—Ä–°–µ–π—Ñ', 'LUX_H': '–õ—é–∫—Å –•–æ–ª–¥–∏–Ω–≥', 'MINES': '–†–µ–¥–∫–∏–µ –ú–µ—Ç–∞–ª–ª—ã', 'BANK': '–ì–ª–æ–±–∞–ª –ë–∞–Ω–∫', 'HEALTH': '–ü—Ä–∏–≤–∞—Ç–Ω—ã–µ –ö–ª–∏–Ω–∏–∫–∏', 'BIO': '–ë–∏–æ–§–∞—Ä–º', 'MEDIA': '–ú–µ–¥–∏–∞ –ì—Ä—É–ø–ø', 'GREEN': '–ó–µ–ª–µ–Ω–∞—è –≠–Ω–µ—Ä–≥–µ—Ç–∏–∫–∞', 'NEW_T': '–ù–æ–≤—ã–µ –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏', 'GALAXY': '–°–µ—Ç–∏ "–ì–∞–ª–∞–∫—Ç–∏–∫–∞"', 'GOLDX': '–ó–æ–ª–æ—Ç–æ–π –†–µ–∑–µ—Ä–≤', 'PHARMA': '–§–∞—Ä–º–≠–∫—Å–ø—Ä–µ—Å—Å', 'AERO': '–ê—ç—Ä–æ–∫–æ—Å–º–æ—Å', 'ECOT': '–≠–∫–æ-–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏', 'DREAM': '–¶–∏—Ñ—Ä–æ–≤—ã–µ –†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è', 'STEEL': '–°—Ç–∞–ª—å–ì—Ä–∞–¥', 'FOOD': '–ü—Ä–æ–¥—É–∫—Ç–æ–≤—ã–π –ì–∏–≥–∞–Ω—Ç', 'MERC': '–ú–µ—Ä–∫—É—Ä–∏–π –õ–æ–≥–∏—Å—Ç–∏–∫—Å', 'CRYP': '–ö—Ä–∏–ø—Ç–æ-–§–æ–Ω–¥', 'OIL': '–ù–µ—Ñ—Ç–µ–¥–æ–±—ã—á–∞', 'SOFT': '–°–æ—Ñ—Ç–í–æ—Ä–∫—Å –ò–¢', 'MINI': '–ú–∏–Ω–∏-–ó–∞–≤–æ–¥', 'WATER': '–í–æ–¥–Ω—ã–µ –†–µ—Å—É—Ä—Å—ã', 'CANDY': '–ö–æ–Ω–¥–∏—Ç–µ—Ä—Å–∫–∞—è –§–∞–±—Ä–∏–∫–∞', };
    let apartmentData = [ { key: 'STUDIO', name: '–°—Ç—É–¥–∏—è "–ú–∏–Ω–∏–º–∞–ª–∏–∑–º"', basePrice: 20000 }, { key: 'ONE_BR', name: '1-–∫–æ–º–Ω–∞—Ç–Ω–∞—è "–ö–æ–º—Ñ–æ—Ä—Ç"', basePrice: 85000 }, { key: 'TWO_BR', name: '2-–∫–æ–º–Ω–∞—Ç–Ω–∞—è "–°–µ–º–µ–π–Ω–∞—è"', basePrice: 195000 }, { key: 'LUXE', name: '–ü–µ–Ω—Ç—Ö–∞—É—Å "–ü—Ä–µ—Å—Ç–∏–∂"', basePrice: 450000 }, { key: 'MANSION', name: '–û—Å–æ–±–Ω—è–∫ "–≠–ª–∏—Ç–∞"', basePrice: 1200000 }, { key: 'VILLA', name: '–í–∏–ª–ª–∞ "–£–ª—å—Ç—Ä–∞-–õ—é–∫—Å"', basePrice: 3500000 }, { key: 'ESTATE', name: '–ü–æ–º–µ—Å—Ç—å–µ "–ò–º–ø–µ—Ä–∏–∞–ª"', basePrice: 10000000 }, ];
    let availableApartments = []; 
    let transportData = [ { key: 'SCOOTER', name: '–°–∫—É—Ç–µ—Ä', basePrice: 12000 }, { key: 'CAR_STD', name: '–°–µ–¥–∞–Ω', basePrice: 40000 }, { key: 'BUS', name: '–ê–≤—Ç–æ–±—É—Å', basePrice: 150000 }, { key: 'TRUCK', name: '–ì—Ä—É–∑–æ–≤–∏–∫', basePrice: 280000 }, { key: 'YACHT', name: '–Ø—Ö—Ç–∞', basePrice: 900000 }, { key: 'TRAIN', name: '–ü–æ–µ–∑–¥', basePrice: 2500000 }, { key: 'PLANE', name: '–ß–∞—Å—Ç–Ω—ã–π —Å–∞–º–æ–ª–µ—Ç', basePrice: 7000000 }, ];
    let availableTransport = [];

    // --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ò–ù–í–ï–ù–¢–ê–†–Ø ---
    const initialInventory = Object.keys(initialPrices).reduce((acc, ticker) => ({ ...acc, [ticker]: { quantity: 0, totalCost: 0 } }), {});
    const initialRealEstate = apartmentData.reduce((acc, apt) => ({ ...acc, [apt.key]: 0 }), {});
    const initialTransport = transportData.reduce((acc, v) => ({ ...acc, [v.key]: 0 }), {});
    
    // –ö–ª—é—á–∏ Local Storage
    const LOCAL_STORAGE_KEY_PORTFOLIO = 'stockSimPortfolio_v2';
    const LOCAL_STORAGE_KEY_USERID = 'stockSimUserId';
    
    // UI –≠–ª–µ–º–µ–Ω—Ç—ã
    const appContainer = document.getElementById('app-container'), loadingOverlay = document.getElementById('loading-overlay');
    const balanceEl = document.getElementById('player-balance'), userIdEl = document.getElementById('user-id');
    const marketListEl = document.getElementById('market-list'), inventoryListEl = document.getElementById('inventory-list');
    const apartmentListEl = document.getElementById('apartment-list'), transportListEl = document.getElementById('transport-list');
    const businessListEl = document.getElementById('business-list'), businessCountEl = document.getElementById('business-count');
    const messageBoxEl = document.getElementById('message-box'), forceSellOverlay = document.getElementById('force-sell-overlay');
    const limitCountdownEl = document.getElementById('limit-countdown'), apartmentCountdownEl = document.getElementById('apartment-countdown');
    const transportStoreCountdownEl = document.getElementById('transport-store-countdown'), incomeCountdownEl = document.getElementById('income-countdown');
    const businessCountdownEl = document.getElementById('business-countdown'), transportCountdownEl = document.getElementById('transport-countdown');
    const passiveIncomeInfoEl = document.getElementById('passive-income-info'), businessIncomeInfoEl = document.getElementById('business-income-info');
    const transportIncomeInfoEl = document.getElementById('transport-income-info');
    const loanTimerDisplayEl = document.getElementById('loan-timer-display');
    const creditStatusSection = document.getElementById('credit-status-section');
    const takeCreditSection = document.getElementById('take-credit-section');
    const maxLoanAmountEl = document.getElementById('max-loan-amount');
    const loanAmountInput = document.getElementById('loan-amount-input');
    const updateOverlay = document.getElementById('update-overlay');
    const closeUpdateBtn = document.getElementById('close-update-btn');

    // --- –§–£–ù–ö–¶–ò–ò –£–¢–ò–õ–ò–¢–´ ---
    const showMessage = (msg, type = 'info') => { let bgColor='bg-gray-700'; if(type==='success')bgColor='bg-green-600'; if(type==='error')bgColor='bg-red-600'; if(type==='warning')bgColor='bg-yellow-600'; if(type==='business')bgColor='bg-orange-600'; if(type==='credit')bgColor='bg-pink-600'; messageBoxEl.className=`fixed top-20 left-1/2 transform -translate-x-1/2 ${bgColor} text-white p-4 rounded-lg shadow-xl z-100 transition-opacity`; messageBoxEl.textContent=msg; messageBoxEl.classList.remove('hidden'); setTimeout(()=>messageBoxEl.classList.add('hidden'),3000); };
    const formatCurrency = (amount) => (amount.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, " ")+' –≥—Ä–Ω');
    const formatTime = (seconds) => `${String(Math.floor(seconds/60)).padStart(2,'0')}:${String(seconds%60).padStart(2,'0')}`;

    // --- LOCAL STORAGE ---
    const loadPortfolio = () => { const storedData = localStorage.getItem(LOCAL_STORAGE_KEY_PORTFOLIO); let loaded = storedData ? JSON.parse(storedData) : {}; portfolio = { balance: loaded.balance || initialBalance, inventory: { ...initialInventory, ...loaded.inventory }, realEstate: { ...initialRealEstate, ...loaded.realEstate }, businesses: Array.isArray(loaded.businesses) ? loaded.businesses : [], transport: { ...initialTransport, ...loaded.transport }, activeLoan: loaded.activeLoan || null }; renderPortfolio(portfolio); };
    const savePortfolio = () => { localStorage.setItem(LOCAL_STORAGE_KEY_PORTFOLIO, JSON.stringify(portfolio)); renderPortfolio(portfolio); };
    const setupUser = () => { let id=localStorage.getItem(LOCAL_STORAGE_KEY_USERID); if(!id){id='LOCAL-'+Math.random().toString(36).substring(2,9).toUpperCase(); localStorage.setItem(LOCAL_STORAGE_KEY_USERID,id);} userId=id; userIdEl.textContent=userId; };

    // --- –î–í–ò–ñ–ö–ò –î–û–•–û–î–û–í ---
    const startIncomeEngine = (interval, countdownEl, calculationFunc, infoEl, infoText, incomeType) => { let timer = interval / 1000; const loop = () => { timer--; countdownEl.textContent = String(timer).padStart(2, '0'); if (timer <= 0) { const income = calculationFunc(); if (income > 0) { portfolio.balance += income; savePortfolio(); showMessage(`–î–æ—Ö–æ–¥ (${incomeType}): +${formatCurrency(income)}`, 'success'); } timer = interval / 1000; } setTimeout(loop, 1000); }; loop(); };
    const calculateApartmentIncome = () => { let total = 0; for (const [key, count] of Object.entries(portfolio.realEstate)) { if (count > 0) { const data = apartmentData.find(a => a.key === key); if (data) total += data.basePrice * APARTMENT_FIXED_INCOME_RATE * count; } } passiveIncomeInfoEl.textContent = `–î–æ—Ö–æ–¥ (–ö–≤–∞—Ä—Ç–∏—Ä—ã): ${formatCurrency(total)} / ${PASSIVE_INCOME_INTERVAL/1000} —Å–µ–∫`; return total; };
    const calculateBusinessIncome = () => { let total = portfolio.businesses.reduce((sum, b) => sum + b.investment * BUSINESS_INCOME_RATE, 0); businessIncomeInfoEl.textContent = `–î–æ—Ö–æ–¥ (–ë–∏–∑–Ω–µ—Å): ${formatCurrency(total)} / ${BUSINESS_INCOME_INTERVAL/1000} —Å–µ–∫`; return total; };
    const calculateTransportIncome = () => { let total = 0; for (const [key, count] of Object.entries(portfolio.transport)) { if (count > 0) { const data = transportData.find(t => t.key === key); if (data) total += data.basePrice * TRANSPORT_INCOME_RATE * count; } } transportIncomeInfoEl.textContent = `–î–æ—Ö–æ–¥ (–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç): ${formatCurrency(total)} / ${TRANSPORT_INCOME_INTERVAL/1000} —Å–µ–∫`; return total; };

    // --- –î–í–ò–ñ–ö–ò –ú–ê–ì–ê–ó–ò–ù–û–í –ò –†–´–ù–ö–ê ---
    const startStoreEngine = (interval, countdownEl, generatorFunc) => { let timer = interval / 1000; generatorFunc(); setInterval(generatorFunc, interval); const loop = () => { timer--; if(timer<=0) timer=interval/1000; countdownEl.textContent=formatTime(timer); setTimeout(loop, 1000); }; loop(); };
    const generateShopItems = (data, volatility = 0.2) => data.map(item => { const limit = item.basePrice > 1000000 && Math.random() < 0.4 ? 0 : Math.floor(Math.random() * 5) + 1; const fluctuation = (Math.random() * volatility * 2) - volatility; const currentPrice = item.basePrice * (1 + fluctuation); return { ...item, currentPrice: Math.round(currentPrice / 100) * 100, availableLimit: limit }; });
    const generateApartments = () => { availableApartments = generateShopItems(apartmentData); renderRealEstate(); };
    const generateTransport = () => { availableTransport = generateShopItems(transportData); renderTransport(); };
    const startMarketEngine = () => { if (isMarketEngineRunning) return; isMarketEngineRunning = true; currentPrices = { ...initialPrices }; renderMarket(currentPrices, {}); const marketLoop = () => { const prevPrices = { ...currentPrices }; lastPrevPrices = prevPrices; for (const [ticker, price] of Object.entries(currentPrices)) { let maxChange = (price > 1000000) ? 0.03 : 0.05; let minChange = -maxChange; const change = (Math.random() * (maxChange - minChange) + minChange); currentPrices[ticker] = Math.max(price * (1 + change), 0.01); } renderMarket(currentPrices, prevPrices); renderPortfolio(portfolio); const nextUpdate = Math.random() * (PRICE_UPDATE_INTERVAL_MAX - PRICE_UPDATE_INTERVAL_MIN) + PRICE_UPDATE_INTERVAL_MIN; setTimeout(marketLoop, nextUpdate); }; marketLoop(); };
    const startStockLimitEngine = () => { const resetLimits = () => { marketLimits = Object.entries(currentPrices).reduce((acc, [ticker, price]) => { let limit; if (price >= 5000000 && Math.random() < 0.3) { limit = 0; } else if (price >= 10000000) { limit = 1; } else if (price >= 1000000) { limit = Math.floor(Math.random() * 2) + 1; } else { const normalized = Math.min(1, Math.max(0, (price - 14.5) / (MAX_SIM_PRICE - 14.5))); limit = 1 + ((1 - normalized) * 19); limit = Math.round(limit * (1 + (Math.random() * 0.5 - 0.25))); } acc[ticker] = Math.min(20, Math.max(1, limit)); return acc; }, {}); }; resetLimits(); setInterval(() => { resetLimits(); renderMarket(currentPrices, lastPrevPrices); showMessage("–õ–∏–º–∏—Ç—ã –∞–∫—Ü–∏–π –æ–±–Ω–æ–≤–ª–µ–Ω—ã!", 'info'); }, STOCK_LIMIT_REFRESH_INTERVAL); startStoreEngine(STOCK_LIMIT_REFRESH_INTERVAL, limitCountdownEl, ()=>{}); };

    // --- –õ–û–ì–ò–ö–ê –ü–û–ö–£–ü–ö–ò/–ü–†–û–î–ê–ñ–ò ---
    window.buyAsset = (ticker, amount) => { const price = currentPrices[ticker]; const cost = price * amount; if (portfolio.balance < cost) { showMessage("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤.", 'error'); return; } if (marketLimits[ticker] < amount) { showMessage(`–õ–∏–º–∏—Ç –Ω–∞ –ø–æ–∫—É–ø–∫—É ${ticker} –∏—Å—á–µ—Ä–ø–∞–Ω.`, 'error'); return; } marketLimits[ticker] -= amount; const item = portfolio.inventory[ticker]; portfolio.balance -= cost; item.quantity += amount; item.totalCost += cost; savePortfolio(); renderMarket(currentPrices, lastPrevPrices); showMessage(`–ö—É–ø–ª–µ–Ω–æ ${amount} —à—Ç. ${ticker}.`, 'success'); };
    window.sellAsset = (ticker, amount) => { const price = currentPrices[ticker]; const revenue = price * amount; const item = portfolio.inventory[ticker]; if (item.quantity < amount) { showMessage(`–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ ${ticker} –¥–ª—è –ø—Ä–æ–¥–∞–∂–∏.`, 'error'); return; } let costOfSold = 0; if (item.quantity > 0) costOfSold = (item.totalCost / item.quantity) * amount; portfolio.balance += revenue; item.quantity -= amount; item.totalCost -= costOfSold; if(item.quantity<=0){item.quantity=0; item.totalCost=0;} savePortfolio(); showMessage(`–ü—Ä–æ–¥–∞–Ω–æ ${amount} —à—Ç. ${ticker}.`, 'success'); };
    window.buyShopItem = (key, availableList, portfolioList, type) => { const item = availableList.find(i => i.key === key); if (!item) return; if (portfolio.balance < item.currentPrice) { showMessage("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤.", 'error'); return; } if (item.availableLimit <= 0) { showMessage(`–õ–∏–º–∏—Ç –Ω–∞ –ø–æ–∫—É–ø–∫—É –∏—Å—á–µ—Ä–ø–∞–Ω.`, 'error'); return; } item.availableLimit--; portfolio.balance -= item.currentPrice; portfolioList[key] = (portfolioList[key] || 0) + 1; savePortfolio(); if(type==='–ö–≤–∞—Ä—Ç–∏—Ä–∞') renderRealEstate(); else if(type==='–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç') renderTransport(); showMessage(`–ö—É–ø–ª–µ–Ω–∞ 1 —à—Ç. "${item.name}".`, 'success'); };
    window.sellShopItem = (key, portfolioList, dataList, saleFactor, type) => { if ((portfolioList[key] || 0) <= 0) return; const itemData = dataList.find(i => i.key === key); if (!itemData) return; const salePrice = itemData.basePrice * saleFactor; portfolio.balance += salePrice; portfolioList[key]--; savePortfolio(); showMessage(`–ü—Ä–æ–¥–∞–Ω–∞ 1 —à—Ç. "${itemData.name}". –ü–æ–ª—É—á–µ–Ω–æ: ${formatCurrency(salePrice)}`, 'success'); };
    window.handleOpenBusiness = () => { const name = document.getElementById('business-name-input').value.trim() || "–ë–∏–∑–Ω–µ—Å"; const investment = parseFloat(document.getElementById('business-investment-input').value); if (portfolio.businesses.length >= MAX_BUSINESSES) { showMessage(`–î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç: ${MAX_BUSINESSES} –±–∏–∑–Ω–µ—Å–æ–≤.`, 'error'); return; } if (isNaN(investment) || investment < 1) { showMessage(`–°—É–º–º–∞ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å > 1 –≥—Ä–Ω.`, 'error'); return; } if (portfolio.balance < investment) { showMessage("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤.", 'error'); return; } portfolio.balance -= investment; portfolio.businesses.push({ id: 'id-'+Date.now(), name, investment }); savePortfolio(); renderBusinessSection(); document.getElementById('business-name-input').value=''; document.getElementById('business-investment-input').value=''; showMessage(`–ë–∏–∑–Ω–µ—Å "${name}" –æ—Ç–∫—Ä—ã—Ç!`, 'success'); };
    window.sellBusiness = (id) => { const index = portfolio.businesses.findIndex(b => b.id === id); if (index === -1) return; const business = portfolio.businesses[index]; const salePrice = business.investment * (1.05 + Math.random() * 0.30); portfolio.balance += salePrice; portfolio.businesses.splice(index, 1); savePortfolio(); renderBusinessSection(); showMessage(`–ë–∏–∑–Ω–µ—Å "${business.name}" –ø—Ä–æ–¥–∞–Ω –∑–∞ ${formatCurrency(salePrice)}!`, 'success'); };
    
    // --- –ö–†–ï–î–ò–¢–´ ---
    let loanEngineInterval = null;
    const calculateTotalIncomePerMinute = () => (calculateApartmentIncome()*(60000/PASSIVE_INCOME_INTERVAL) + calculateBusinessIncome()*(60000/BUSINESS_INCOME_INTERVAL) + calculateTransportIncome()*(60000/TRANSPORT_INCOME_INTERVAL));
    const calculateMaxLoan = () => (calculateTotalIncomePerMinute() * 10) + (portfolio.balance * 0.5);
    window.handleTakeLoan = () => { const maxLoan = calculateMaxLoan(); const amount = parseFloat(loanAmountInput.value); if(isNaN(amount) || amount <= 0 || amount > maxLoan) { showMessage('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å—É–º–º–∞ –∫—Ä–µ–¥–∏—Ç–∞.', 'error'); return; } portfolio.balance += amount; portfolio.activeLoan = { amount: amount, debt: amount * LOAN_REPAYMENT_FEE, dueDate: Date.now() + LOAN_GRACE_PERIOD, autoDeductDate: Date.now() + LOAN_GRACE_PERIOD + LOAN_AUTO_DEDUCT_INTERVAL }; loanAmountInput.value = ''; savePortfolio(); startLoanEngine(); showMessage(`–í—ã –≤–∑—è–ª–∏ –∫—Ä–µ–¥–∏—Ç –Ω–∞ ${formatCurrency(amount)}. –ù—É–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å ${formatCurrency(portfolio.activeLoan.debt)}`, 'credit'); };
    window.handleRepayLoan = () => { const debt = portfolio.activeLoan.debt; if(portfolio.balance < debt) { showMessage('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –¥–ª—è –ø–æ–≥–∞—à–µ–Ω–∏—è –∫—Ä–µ–¥–∏—Ç–∞.', 'error'); return; } portfolio.balance -= debt; portfolio.activeLoan = null; if(loanEngineInterval) clearInterval(loanEngineInterval); loanTimerDisplayEl.textContent = '–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫—Ä–µ–¥–∏—Ç–æ–≤'; savePortfolio(); showMessage('–ö—Ä–µ–¥–∏—Ç —É—Å–ø–µ—à–Ω–æ –ø–æ–≥–∞—à–µ–Ω!', 'success'); };
    const startLoanEngine = () => { if (!portfolio.activeLoan) { if (loanEngineInterval) clearInterval(loanEngineInterval); renderCreditsSection(); return; } if(loanEngineInterval) clearInterval(loanEngineInterval); loanEngineInterval = setInterval(() => { const loan = portfolio.activeLoan; if(!loan) { clearInterval(loanEngineInterval); loanTimerDisplayEl.textContent = '–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫—Ä–µ–¥–∏—Ç–æ–≤'; return; } const now = Date.now(); let displayMessage = ''; if(now < loan.dueDate) { const remaining = Math.round((loan.dueDate - now) / 1000); displayMessage = `–î–æ –∞–≤—Ç–æ-—Å–ø–∏—Å–∞–Ω–∏—è: ${formatTime(remaining)}`; } else { const remainingForDeduct = Math.round((loan.autoDeductDate - now) / 1000); displayMessage = `–°–ø–∏—Å–∞–Ω–∏–µ —á–µ—Ä–µ–∑: ${formatTime(remainingForDeduct)}`; if(now >= loan.autoDeductDate) { const deductionAmount = loan.debt * LOAN_AUTO_DEDUCT_PERCENT; if(portfolio.balance >= deductionAmount) { portfolio.balance -= deductionAmount; loan.debt -= deductionAmount; loan.autoDeductDate = now + LOAN_AUTO_DEDUCT_INTERVAL; if(loan.debt <= 0) { portfolio.activeLoan = null; showMessage('–ö—Ä–µ–¥–∏—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–ø–∏—Å–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!', 'success'); } else { showMessage(`–ê–≤—Ç–æ-—Å–ø–∏—Å–∞–Ω–∏–µ: -${formatCurrency(deductionAmount)}`, 'warning'); } savePortfolio(); } else { forceSellOverlay.classList.remove('hidden'); document.getElementById('force-sell-debt-info').textContent = `–û—Å—Ç–∞—Ç–æ–∫ –¥–æ–ª–≥–∞: ${formatCurrency(loan.debt)}`; } } } loanTimerDisplayEl.textContent = displayMessage; }, 1000); };

    // --- –§–£–ù–ö–¶–ò–ò –†–ï–ù–î–ï–†–ò–ù–ì–ê UI ---
    window.showSection = (id) => { document.querySelectorAll('.main-content-section').forEach(el=>el.classList.add('hidden')); document.querySelectorAll('#nav-bar button').forEach(el=>{el.classList.remove('nav-item-active','text-blue-400'); el.classList.add('text-gray-400');}); document.getElementById(`${id}-section`).classList.remove('hidden'); document.getElementById(`nav-${id.replace(/-/g,'')}`).classList.add('nav-item-active','text-blue-400'); if(id==='inventory') renderPortfolio(portfolio); if(id==='credits') renderCreditsSection(); };
    const renderShop = (el, items, buyHandler, type) => { el.innerHTML = ''; items.sort((a,b)=>a.currentPrice-b.currentPrice).forEach(item => { const isAvailable = item.availableLimit > 0; const income = type==='–ö–≤–∞—Ä—Ç–∏—Ä–∞' ? item.basePrice*APARTMENT_FIXED_INCOME_RATE : item.basePrice*TRANSPORT_INCOME_RATE; const incomeInterval = type==='–ö–≤–∞—Ä—Ç–∏—Ä–∞' ? PASSIVE_INCOME_INTERVAL/1000 : TRANSPORT_INCOME_INTERVAL/1000; el.innerHTML += `<div class="flex flex-col sm:flex-row items-center justify-between p-4 bg-gray-700 rounded-lg"><div class="flex-grow mb-2 sm:mb-0"><p class="text-xl font-bold text-white">${item.name}</p><p class="text-lg font-semibold text-green-400 mt-1">${formatCurrency(item.currentPrice)}</p><p class="text-sm text-gray-400">–î–æ—Ö–æ–¥ (${incomeInterval} —Å–µ–∫): <span class="font-medium text-green-300">${formatCurrency(income)}</span></p><p class="text-sm font-medium ${isAvailable ? 'text-blue-300' : 'text-red-400 font-bold'} mt-1">${isAvailable ? `–î–æ—Å—Ç—É–ø–Ω–æ: ${item.availableLimit} —à—Ç.` : '–ù–ï–î–û–°–¢–£–ü–ù–û'}</p></div><div class="flex space-x-3"><button onclick="${buyHandler}('${item.key}')" ${isAvailable ? '' : 'disabled'} class="btn-action btn-buy">–ö—É–ø–∏—Ç—å</button></div></div>`; }); };
    const renderRealEstate = () => renderShop(apartmentListEl, availableApartments, 'buyApartment', '–ö–≤–∞—Ä—Ç–∏—Ä–∞');
    const renderTransport = () => renderShop(transportListEl, availableTransport, 'buyTransport', '–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç');
    window.buyApartment = (key) => buyShopItem(key, availableApartments, portfolio.realEstate, '–ö–≤–∞—Ä—Ç–∏—Ä–∞');
    window.buyTransport = (key) => buyShopItem(key, availableTransport, portfolio.transport, '–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç');
    window.sellApartment = (key) => sellShopItem(key, portfolio.realEstate, apartmentData, APARTMENT_SALE_FACTOR, '–ö–≤–∞—Ä—Ç–∏—Ä–∞');
    window.sellTransport = (key) => sellShopItem(key, portfolio.transport, transportData, TRANSPORT_SALE_FACTOR, '–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç');
    const renderMarket = (prices, prevPrices) => { marketListEl.innerHTML = ''; Object.entries(prices).sort(([,a],[,b])=>b-a).forEach(([ticker,price])=>{ const name=assetNames[ticker]; const prev=prevPrices[ticker]||price; const diff=price-prev; const diffPercent=((diff/prev)*100).toFixed(2); const diffClass=diff>0?'price-up':(diff<0?'price-down':''); const diffSign=diff>=0?'‚ñ≤':'‚ñº'; const limit=marketLimits[ticker]||0; marketListEl.innerHTML+=`<div class="flex flex-col sm:flex-row items-center justify-between p-4 bg-gray-700 rounded-lg"><div class="flex-grow mb-2 sm:mb-0"><p class="text-xl font-bold text-white">${name} (${ticker})</p><div class="text-lg font-semibold flex items-center space-x-2"><span class="text-white ${diffClass} pr-2">${formatCurrency(price)}</span><span class="${diffClass} text-sm font-medium">(${diffSign} ${diffPercent}%)</span></div><p class="text-sm font-medium ${limit > 0 ? 'text-blue-300' : 'text-red-400 font-bold'} mt-1">${limit > 0 ? `–î–æ—Å—Ç—É–ø–Ω–æ: ${limit} —à—Ç.` : '–ù–ï–î–û–°–¢–£–ü–ù–û'}</p></div><div class="flex space-x-3"><button onclick="buyAsset('${ticker}', 1)" ${limit>0?'':'disabled'} class="btn-action btn-buy">–ö—É–ø–∏—Ç—å (1 —à—Ç.)</button></div></div>`; }); };
    const renderBusinessSection = () => { businessListEl.innerHTML = ''; const count = portfolio.businesses.length; businessCountEl.textContent = `${count}/${MAX_BUSINESSES}`; document.getElementById('open-business-btn').disabled = count >= MAX_BUSINESSES; if(count===0){businessListEl.innerHTML='<p class="text-gray-500">–£ –≤–∞—Å –Ω–µ—Ç –±–∏–∑–Ω–µ—Å–æ–≤.</p>'; return;} portfolio.businesses.forEach(b => { const income = b.investment * BUSINESS_INCOME_RATE; businessListEl.innerHTML += `<div class="p-4 bg-gray-700 rounded-lg border-l-4 border-orange-500 flex flex-col md:flex-row justify-between items-start md:items-center"><div class="mb-3 md:mb-0"><p class="text-xl font-bold text-white">${b.name}</p><p class="text-md text-gray-400">–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏: <span class="font-medium text-white">${formatCurrency(b.investment)}</span></p><p class="text-md font-medium text-green-300 mt-1">–ü—Ä–∏–±—ã–ª—å (${BUSINESS_INCOME_INTERVAL/1000} —Å–µ–∫): ${formatCurrency(income)}</p></div><button onclick="sellBusiness('${b.id}')" class="btn-action btn-sell-business text-sm">–ü—Ä–æ–¥–∞—Ç—å</button></div>`; }); };
    const renderCreditsSection = () => { if(portfolio.activeLoan) { creditStatusSection.innerHTML = `<h3 class="text-xl font-semibold mb-3">–ê–∫—Ç–∏–≤–Ω—ã–π –ö—Ä–µ–¥–∏—Ç</h3><div class="p-4 bg-gray-800 rounded-lg"><p class="text-gray-400">–°—É–º–º–∞ –∫ –ø–æ–≥–∞—à–µ–Ω–∏—é:</p><p class="text-2xl font-bold text-pink-400 mb-4">${formatCurrency(portfolio.activeLoan.debt)}</p><button onclick="handleRepayLoan()" class="btn-action btn-credit w-full">–ü–æ–≥–∞—Å–∏—Ç—å –ö—Ä–µ–¥–∏—Ç</button></div>`; takeCreditSection.classList.add('hidden'); } else { creditStatusSection.innerHTML = `<p class="text-gray-400">–£ –≤–∞—Å –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫—Ä–µ–¥–∏—Ç–æ–≤. –í—ã –º–æ–∂–µ—Ç–µ –≤–∑—è—Ç—å –Ω–æ–≤—ã–π.</p>`; takeCreditSection.classList.remove('hidden'); maxLoanAmountEl.textContent = formatCurrency(calculateMaxLoan()); } };
    const renderPortfolio = (data) => { balanceEl.textContent = formatCurrency(data.balance); calculateApartmentIncome(); calculateBusinessIncome(); calculateTransportIncome(); if (portfolio.activeLoan && portfolio.balance > portfolio.activeLoan.debt) { forceSellOverlay.classList.add('hidden'); } inventoryListEl.innerHTML = ''; let hasInventory = false; const renderInventoryBlock = (title, items, dataList, sellHandler, saleFactor, color) => { const owned = Object.entries(items).filter(([,count])=>count>0); if(owned.length === 0) return ''; hasInventory=true; let markup = `<h3 class="text-xl font-semibold mb-3 text-${color}-400 border-b border-gray-700 pb-2">${title}</h3>`; owned.forEach(([key, count]) => { const itemData = dataList.find(i => i.key === key); if(!itemData) return; const salePrice = itemData.basePrice * saleFactor; markup += `<div class="p-4 bg-gray-700 rounded-lg border-l-4 border-${color}-500"><div class="flex justify-between items-start"><p class="text-xl font-bold text-white">${itemData.name}</p><p class="text-sm text-gray-400">–í–ª–∞–¥–µ–µ—Ç–µ: ${count} —à—Ç.</p></div><p class="text-sm text-gray-400 mt-1">–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏ (1 —à—Ç.): <span class="font-medium">${formatCurrency(salePrice)}</span></p><div class="mt-3 flex justify-end"><button onclick="${sellHandler}('${key}')" class="btn-action btn-sell text-sm">–ü—Ä–æ–¥–∞—Ç—å 1 —à—Ç.</button></div></div>`; }); return markup + '<div class="h-6"></div>'; }; inventoryListEl.innerHTML += renderInventoryBlock('–ú–æ–π –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç', data.transport, transportData, 'sellTransport', TRANSPORT_SALE_FACTOR, 'violet'); inventoryListEl.innerHTML += renderInventoryBlock('–ú–æ—è –ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å', data.realEstate, apartmentData, 'sellApartment', APARTMENT_SALE_FACTOR, 'yellow'); const ownedStocks = Object.entries(data.inventory).filter(([,item])=>item.quantity > 0); if(ownedStocks.length > 0) { hasInventory=true; let markup='<h3 class="text-xl font-semibold mb-3 text-blue-400 border-b border-gray-700 pb-2">–ú–æ–∏ –ê–∫—Ü–∏–∏</h3>'; ownedStocks.sort(([a],[b])=>a.localeCompare(b)).forEach(([ticker,item])=>{ const price=currentPrices[ticker]||0; const currentValue=price*item.quantity; const avgPrice=item.quantity>0?item.totalCost/item.quantity:0; const profitLoss=currentValue-item.totalCost; const profitPercent=item.totalCost>0?((profitLoss/item.totalCost)*100).toFixed(2):0; const isProfit=profitLoss>0.01, isLoss=profitLoss<-0.01; const profitClass=isProfit?'text-green-400':(isLoss?'text-red-400':'text-gray-400'); markup+=`<div class="p-4 bg-gray-700 rounded-lg border-l-4 ${isProfit?'border-green-500':(isLoss?'border-red-500':'border-gray-500')}"><div class="flex justify-between items-center mb-1"><p class="text-xl font-bold text-white">${assetNames[ticker]} (${ticker})</p><p class="text-sm text-gray-400">${item.quantity} —à—Ç.</p></div><p class="text-md text-gray-300">–°—Ç–æ–∏–º–æ—Å—Ç—å: ${formatCurrency(currentValue)}</p><p class="text-sm text-gray-400">–°—Ä. —Ü–µ–Ω–∞ –ø–æ–∫—É–ø–∫–∏: ${formatCurrency(avgPrice)}</p><div class="mt-2 p-2 rounded-md ${isProfit?'bg-green-900/40':(isLoss?'bg-red-900/40':'bg-gray-800')}"><p class="font-semibold ${profitClass}">${profitLoss>=0?'–ü—Ä–∏–±—ã–ª—å':'–£–±—ã—Ç–æ–∫'}: ${formatCurrency(Math.abs(profitLoss))} (${profitPercent}%)</p></div><div class="mt-3 flex justify-end space-x-3"><button onclick="sellAsset('${ticker}',${item.quantity})" class="btn-action btn-sell-all text-sm">–ü—Ä–æ–¥–∞—Ç—å –í–°–ï</button><button onclick="sellAsset('${ticker}',1)" class="btn-action btn-sell text-sm">–ü—Ä–æ–¥–∞—Ç—å 1</button></div></div>`;}); inventoryListEl.innerHTML+=markup; } if(!hasInventory) inventoryListEl.innerHTML = '<p class="text-gray-500 p-4">–ü–æ—Ä—Ç—Ñ–µ–ª—å –ø—É—Å—Ç.</p>'; };

    // --- –û–ü–û–í–ï–©–ï–ù–ò–ï –û–ë –û–ë–ù–û–í–õ–ï–ù–ò–ò ---
    const checkVersionAndShowUpdate = () => {
        const hasSeenUpdate = localStorage.getItem(LOCAL_STORAGE_KEY_UPDATE_SEEN);
        if (!hasSeenUpdate) {
            updateOverlay.classList.remove('hidden');
        }
        closeUpdateBtn.addEventListener('click', () => {
            updateOverlay.classList.add('hidden');
            localStorage.setItem(LOCAL_STORAGE_KEY_UPDATE_SEEN, 'true');
        });
    };

    // --- –ó–ê–ü–£–°–ö –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø ---
    const setupApp = () => {
        checkVersionAndShowUpdate();
        setupUser();      
        loadPortfolio();  
        startMarketEngine();        
        startStockLimitEngine();    
        startStoreEngine(REAL_ESTATE_REFRESH_INTERVAL, apartmentCountdownEl, generateApartments);
        startStoreEngine(TRANSPORT_REFRESH_INTERVAL, transportStoreCountdownEl, generateTransport);
        startIncomeEngine(PASSIVE_INCOME_INTERVAL, incomeCountdownEl, calculateApartmentIncome, passiveIncomeInfoEl, ``, '–ö–≤–∞—Ä—Ç–∏—Ä—ã');
        startIncomeEngine(BUSINESS_INCOME_INTERVAL, businessCountdownEl, calculateBusinessIncome, businessIncomeInfoEl, ``, '–ë–∏–∑–Ω–µ—Å');
        startIncomeEngine(TRANSPORT_INCOME_INTERVAL, transportCountdownEl, calculateTransportIncome, transportIncomeInfoEl, ``, '–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç');
        startLoanEngine();
        
        showSection('market'); 

        loadingOverlay.classList.add('hidden');
        appContainer.classList.remove('hidden');
    };

    window.onload = setupApp;

</script>
</body>
</html>

